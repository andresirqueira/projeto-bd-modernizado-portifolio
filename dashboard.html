<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard Interativo - Estat√≠sticas do Sistema</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config = { darkMode: 'class' };</script>
  <link rel="stylesheet" href="css/estilo-base.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="static/js/demo-banner.js"></script>
  <script src="static/js/chart.min.js"></script>
  <link rel="icon" type="image/png" href="static/img/favicon-dashboard.png">
  <style>
    .dashboard-card {
      background: linear-gradient(135deg, #6366f1 0%, #60a5fa 100%);
      color: #fff;
      border-radius: 1.2rem;
      box-shadow: 0 4px 24px #0002;
      padding: 1.3rem 1rem 1rem 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 120px;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    .dashboard-card:hover {
      transform: translateY(-6px) scale(1.05);
      box-shadow: 0 12px 40px #0004;
    }
    .dashboard-card.clickable {
      cursor: pointer;
    }
    .dashboard-card.clickable:hover {
      transform: translateY(-8px) scale(1.08);
    }
    .dashboard-card .icon-bg {
      position: absolute;
      top: -24px;
      right: -24px;
      font-size: 5.5rem;
      color: #fff2;
      pointer-events: none;
      z-index: 0;
    }
    .dashboard-card .icon {
      font-size: 1.8rem;
      margin-bottom: 0.5rem;
      z-index: 1;
    }
    .dashboard-card .title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.3rem;
      z-index: 1;
      letter-spacing: 0.01em;
      text-align: center;
    }
    .dashboard-card .value {
      font-size: 1.8rem;
      font-weight: 800;
      z-index: 1;
      margin-bottom: 0.3rem;
    }
    .dashboard-card .desc {
      font-size: 0.85rem;
      color: #e0e7ff;
      z-index: 1;
      text-align: center;
    }
    .dashboard-card .trend {
      font-size: 0.75rem;
      margin-top: 0.3rem;
      z-index: 1;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    .dashboard-card .trend.up {
      color: #10b981;
    }
    .dashboard-card .trend.down {
      color: #ef4444;
    }
    
    /* Cards compactos para estat√≠sticas espec√≠ficas */
    .compact-card {
      min-height: 100px;
      padding: 1rem 0.8rem;
    }
    .compact-card .title {
      font-size: 0.9rem;
    }
    .compact-card .value {
      font-size: 1.5rem;
    }
    .compact-card .desc {
      font-size: 0.8rem;
    }
    
    /* Navega√ß√£o por abas */
    .tab-nav {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 1rem;
      padding: 0.5rem;
      margin-bottom: 2rem;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .tab-button {
      background: transparent;
      color: #fff;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 0.8rem;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .tab-button:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    .tab-button.active {
      background: #fff;
      color: #6366f1;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    /* Se√ß√µes de conte√∫do */
    .content-section {
      display: none;
    }
    .content-section.active {
      display: block;
    }
    
    /* Filtros */
    .filter-container {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 1rem;
      padding: 1rem;
      margin-bottom: 2rem;
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      align-items: center;
    }
    .filter-select {
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: #fff;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      min-width: 150px;
    }
    .filter-select option {
      background: #1f2937;
      color: #fff;
    }
    
    /* Responsividade */
    @media (max-width: 640px) {
      .dashboard-card { 
        min-height: 100px; 
        padding: 1rem 0.8rem; 
      }
      .dashboard-card .value { 
        font-size: 1.4rem; 
      }
      .dashboard-card .icon-bg { 
        font-size: 3rem; 
      }
      .tab-nav {
        flex-direction: column;
      }
      .filter-container {
        flex-direction: column;
        align-items: stretch;
      }
    }
    
    /* Anima√ß√µes */
    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Gr√°ficos compactos */
    .chart-container {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 1.2rem;
      padding: 1.5rem;
      margin-bottom: 2rem;
      min-height: 300px;
      transition: all 0.3s ease;
    }
    .dark .chart-container {
      background: rgba(24, 30, 42, 0.8);
    }
    .chart-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: 1rem;
      text-align: center;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-indigo-400 to-purple-600 min-h-screen flex flex-col items-center justify-center dark:bg-gradient-to-br dark:from-gray-900 dark:to-gray-800">
  <button onclick="voltarPainelConfig()" class="fixed top-6 left-6 z-50 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-full p-3 transition-colors shadow-lg" title="Voltar ao painel">
    <i class="fas fa-arrow-left text-gray-700 dark:text-gray-300"></i>
  </button>
  <div class="w-full max-w-7xl mx-auto mt-10 mb-10 px-2">
    <!-- Cabe√ßalho -->
    <div class="flex flex-wrap justify-between items-center mb-8 gap-4">
      <h1 class="text-3xl font-bold text-white">
        <i class="fas fa-chart-line text-indigo-300 mr-3"></i>
        Dashboard Interativo
      </h1>
      <div class="flex gap-2">
        <button onclick="toggleDarkMode()" class="bg-white/20 hover:bg-white/30 rounded-full p-3 transition-colors" title="Alternar modo escuro">
          <span class="dark:hidden">üåô</span><span class="hidden dark:inline">‚òÄÔ∏è</span>
        </button>
        <button onclick="refreshData()" class="bg-white/20 hover:bg-white/30 rounded-full p-3 transition-colors" title="Atualizar dados">
          <i class="fas fa-sync-alt text-white"></i>
        </button>
      </div>
    </div>

    <!-- Navega√ß√£o por abas -->
    <div class="tab-nav">
      <button class="tab-button active" onclick="showTab('overview')">
        <i class="fas fa-tachometer-alt"></i>
        Vis√£o Geral
      </button>
      <button class="tab-button" onclick="showTab('equipamentos')">
        <i class="fas fa-desktop"></i>
        Equipamentos
      </button>
      <button class="tab-button" onclick="showTab('salas')">
        <i class="fas fa-door-open"></i>
        Salas
      </button>
      <button class="tab-button" onclick="showTab('switches')">
        <i class="fas fa-network-wired"></i>
        Switches
      </button>
      <button class="tab-button" onclick="showTab('cabos')">
        <i class="fas fa-plug"></i>
        Cabos
      </button>
      <button class="tab-button" onclick="showTab('fontes')">
        <i class="fas fa-bolt"></i>
        Fontes
      </button>
      <button class="tab-button" onclick="showTab('analytics')">
        <i class="fas fa-chart-bar"></i>
        An√°lises
      </button>
    </div>

    <!-- Filtros -->
    <div class="filter-container" id="filterContainer">
      <label class="text-white font-semibold">Filtros:</label>
      <select class="filter-select" id="filterSala" onchange="applyFilters()">
        <option value="">Todas as Salas</option>
      </select>
      <select class="filter-select" id="filterTipo" onchange="applyFilters()">
        <option value="">Todos os Tipos</option>
      </select>
      <select class="filter-select" id="filterStatus" onchange="applyFilters()">
        <option value="">Todos os Status</option>
        <option value="funcionando">Funcionando</option>
        <option value="defeito">Com Defeito</option>
        <option value="indisponivel">Indispon√≠vel</option>
      </select>
      <button onclick="clearFilters()" class="bg-red-500/20 hover:bg-red-500/30 text-white px-4 py-2 rounded-lg transition-colors">
        <i class="fas fa-times mr-2"></i>Limpar
      </button>
    </div>

    <!-- Se√ß√£o: Vis√£o Geral -->
    <div id="overview" class="content-section active">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8" id="cardsOverview"></div>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="chart-container">
          <div class="chart-title">Status dos Equipamentos</div>
          <canvas id="chartStatusOverview"></canvas>
        </div>
        <div class="chart-container">
          <div class="chart-title">Distribui√ß√£o por Sala</div>
          <canvas id="chartSalasOverview"></canvas>
        </div>
      </div>
    </div>

    <!-- Se√ß√£o: Equipamentos -->
    <div id="equipamentos" class="content-section">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-8" id="cardsEquipamentos"></div>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="chart-container">
          <div class="chart-title">Equipamentos por Tipo</div>
          <canvas id="chartTiposEquipamentos"></canvas>
        </div>
        <div class="chart-container">
          <div class="chart-title">Equipamentos por Marca</div>
          <canvas id="chartMarcasEquipamentos"></canvas>
        </div>
      </div>
    </div>

    <!-- Se√ß√£o: Salas -->
    <div id="salas" class="content-section">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-8" id="cardsSalas"></div>
      <div class="chart-container">
        <div class="chart-title">Equipamentos por Sala</div>
        <canvas id="chartEquipamentosSalas"></canvas>
      </div>
    </div>

    <!-- Se√ß√£o: Switches -->
    <div id="switches" class="content-section">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-8" id="cardsSwitches"></div>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="chart-container">
          <div class="chart-title">Ocupa√ß√£o de Portas</div>
          <canvas id="chartPortasSwitches"></canvas>
        </div>
        <div class="chart-container">
          <div class="chart-title">Switches por Sala</div>
          <canvas id="chartSwitchesSalas"></canvas>
        </div>
      </div>
    </div>

    <!-- Se√ß√£o: Cabos -->
    <div id="cabos" class="content-section">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8" id="cardsCabos"></div>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="chart-container">
          <div class="chart-title">Cabos por Tipo</div>
          <canvas id="chartTiposCabos"></canvas>
        </div>
        <div class="chart-container">
          <div class="chart-title">Status das Conex√µes</div>
          <canvas id="chartStatusCabos"></canvas>
        </div>
      </div>
    </div>

    <!-- Se√ß√£o: Fontes -->
    <div id="fontes" class="content-section">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-8" id="cardsFontes"></div>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="chart-container">
          <div class="chart-title">Status das Fontes</div>
          <canvas id="chartStatusFontes"></canvas>
        </div>
        <div class="chart-container">
          <div class="chart-title">Fontes por Sala</div>
          <canvas id="chartFontesSalas"></canvas>
        </div>
      </div>
    </div>

    <!-- Se√ß√£o: An√°lises -->
    <div id="analytics" class="content-section">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="chart-container">
          <div class="chart-title">Equipamentos Dependentes de Rede</div>
          <canvas id="chartRedeAnalytics"></canvas>
        </div>
        <div class="chart-container">
          <div class="chart-title">Distribui√ß√£o por Andar</div>
          <canvas id="chartAndaresAnalytics"></canvas>
        </div>
        <div class="chart-container lg:col-span-2">
          <div class="chart-title">Distribui√ß√£o de Equipamentos por Status</div>
          <canvas id="chartTendenciasAnalytics"></canvas>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Vari√°veis globais
    let equipamentos = [];
    let salas = [];
    let switches = [];
    let portas = [];
    let cabos = [];
    let conexoesCabos = [];
    let currentTab = 'overview';
    let currentFilters = {
      sala: '',
      tipo: '',
      status: ''
    };

    // Inicializa√ß√£o
    document.addEventListener('DOMContentLoaded', function() {
      initializeTheme();
      fetchData();
    });

    function initializeTheme() {
      if (localStorage.getItem('theme') === 'dark') {
        document.documentElement.classList.add('dark');
      } else if (localStorage.getItem('theme') === 'light') {
        document.documentElement.classList.remove('dark');
      }
    }

    function toggleDarkMode() {
      if (document.documentElement.classList.contains('dark')) {
        document.documentElement.classList.remove('dark');
        localStorage.setItem('theme', 'light');
      } else {
        document.documentElement.classList.add('dark');
        localStorage.setItem('theme', 'dark');
      }
      // Atualizar gr√°ficos ap√≥s mudan√ßa de tema
      setTimeout(() => {
        if (currentTab === 'overview') renderOverviewCharts();
        else if (currentTab === 'equipamentos') renderEquipamentosCharts();
        else if (currentTab === 'salas') renderSalasCharts();
        else if (currentTab === 'switches') renderSwitchesCharts();
        else if (currentTab === 'cabos') renderCabosCharts();
        else if (currentTab === 'fontes') renderFontesCharts();
        else if (currentTab === 'analytics') renderAnalyticsCharts();
      }, 300);
    }

    function refreshData() {
      const button = event.target.closest('button');
      const icon = button.querySelector('i');
      icon.classList.add('fa-spin');
      
      fetchData().then(() => {
        icon.classList.remove('fa-spin');
        showNotification('Dados atualizados com sucesso!', 'success');
      }).catch(() => {
        icon.classList.remove('fa-spin');
        showNotification('Erro ao atualizar dados', 'error');
      });
    }

    async function fetchData() {
      try {
        const [equipResp, salasResp, switchesResp, cabosResp, conexoesResp] = await Promise.all([
          fetch('/equipamentos'),
          fetch('/salas'),
          fetch('/switches'),
          fetch('/cabos'),
          fetch('/conexoes-cabos')
        ]);
        
        equipamentos = await equipResp.json();
        salas = await salasResp.json();
        switches = await switchesResp.json();
        cabos = await cabosResp.json();
        conexoesCabos = await conexoesResp.json();
        
        // Buscar todas as portas de todos os switches
        portas = [];
        await Promise.all(switches.map(async (sw) => {
          const resp = await fetch(`/switch-portas/${sw.id}`);
          if (resp.ok) {
            const portasSwitch = await resp.json();
            portas = portas.concat(portasSwitch);
          }
        }));
        
        populateFilters();
        renderCurrentTab();
      } catch (error) {
        console.error('Erro ao buscar dados:', error);
        showNotification('Erro ao carregar dados', 'error');
      }
    }
    // Fun√ß√µes de navega√ß√£o
    function showTab(tabName) {
      // Atualizar bot√µes de navega√ß√£o
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      // Esconder todas as se√ß√µes
      document.querySelectorAll('.content-section').forEach(section => {
        section.classList.remove('active');
      });
      
      // Mostrar se√ß√£o selecionada
      document.getElementById(tabName).classList.add('active');
      currentTab = tabName;
      
      // Renderizar conte√∫do da aba
      renderCurrentTab();
    }

    function renderCurrentTab() {
      switch(currentTab) {
        case 'overview':
          renderOverviewCards();
          renderOverviewCharts();
          break;
        case 'equipamentos':
          renderEquipamentosCards();
          renderEquipamentosCharts();
          break;
        case 'salas':
          renderSalasCards();
          renderSalasCharts();
          break;
        case 'switches':
          renderSwitchesCards();
          renderSwitchesCharts();
          break;
        case 'cabos':
          renderCabosCards();
          renderCabosCharts();
          break;
        case 'fontes':
          renderFontesCards();
          renderFontesCharts();
          break;
        case 'analytics':
          renderAnalyticsCharts();
          break;
      }
    }

    // Fun√ß√µes de filtro
    function populateFilters() {
      // Popular filtro de salas
      const filterSala = document.getElementById('filterSala');
      filterSala.innerHTML = '<option value="">Todas as Salas</option>';
      salas.forEach(sala => {
        if (sala.andar_id !== null && sala.andar_id !== undefined) {
          filterSala.innerHTML += `<option value="${sala.id}">${sala.nome}</option>`;
        }
      });

      // Popular filtro de tipos
      const filterTipo = document.getElementById('filterTipo');
      filterTipo.innerHTML = '<option value="">Todos os Tipos</option>';
      const tipos = [...new Set(equipamentos.map(eq => eq.tipo).filter(Boolean))];
      tipos.forEach(tipo => {
        filterTipo.innerHTML += `<option value="${tipo}">${tipo}</option>`;
      });
    }

    function applyFilters() {
      currentFilters.sala = document.getElementById('filterSala').value;
      currentFilters.tipo = document.getElementById('filterTipo').value;
      currentFilters.status = document.getElementById('filterStatus').value;
      renderCurrentTab();
    }

    function clearFilters() {
      document.getElementById('filterSala').value = '';
      document.getElementById('filterTipo').value = '';
      document.getElementById('filterStatus').value = '';
      currentFilters = { sala: '', tipo: '', status: '' };
      renderCurrentTab();
    }

    // Fun√ß√£o para obter equipamentos filtrados
    function getFilteredEquipamentos() {
      let filtered = equipamentos.filter(eq => 
        !eq.nome || !eq.nome.toLowerCase().includes('ponto usu√°rio')
      );

      if (currentFilters.sala) {
        filtered = filtered.filter(eq => eq.sala_id == currentFilters.sala);
      }
      if (currentFilters.tipo) {
        filtered = filtered.filter(eq => eq.tipo === currentFilters.tipo);
      }
      if (currentFilters.status) {
        if (currentFilters.status === 'funcionando') {
          filtered = filtered.filter(eq => !(eq.defeito === 1 || eq.defeito === true || eq.defeito === '1' || eq.defeito === 2));
        } else if (currentFilters.status === 'defeito') {
          filtered = filtered.filter(eq => eq.defeito === 1 || eq.defeito === true || eq.defeito === '1');
        } else if (currentFilters.status === 'indisponivel') {
          filtered = filtered.filter(eq => eq.defeito === 2);
        }
      }

      return filtered;
    }

    // Fun√ß√£o para criar cards
    function createCard(icon, iconBg, title, value, desc, bg, trend = null, clickable = false) {
      const trendHtml = trend ? `<div class="trend ${trend.direction}"><i class="fas ${trend.icon}"></i>${trend.text}</div>` : '';
      const clickableClass = clickable ? 'clickable' : '';
      
      return `
        <div class="dashboard-card bg-gradient-to-br ${bg} ${clickableClass}" ${clickable ? 'onclick="showCardDetails(\'' + title + '\')"' : ''}>
          <i class="fas ${icon} icon"></i>
          <span class="icon-bg fas ${iconBg}"></span>
          <div class="title">${title}</div>
          <div class="value">${value}</div>
          <div class="desc">${desc}</div>
          ${trendHtml}
        </div>
      `;
    }

    // Fun√ß√µes de renderiza√ß√£o para cada se√ß√£o
    function renderOverviewCards() {
      const equipamentosRegulares = getFilteredEquipamentos().filter(eq => 
        !eq.tipo || !eq.tipo.toLowerCase().includes('fonte')
      );
      const fontes = equipamentos.filter(eq => eq.tipo && eq.tipo.toLowerCase().includes('fonte'));
      
      let funcionando = 0, defeito = 0, indisponivel = 0, rede = 0;
      equipamentosRegulares.forEach(eq => {
        const defeitoValue = parseInt(eq.defeito) || 0;
        if (defeitoValue === 1) {
          defeito++;
        } else if (defeitoValue === 2) {
          indisponivel++;
        } else {
          funcionando++;
        }
        if (eq.dados && (eq.dados.ip1 || eq.dados.mac1 || eq.dados.ip2 || eq.dados.mac2)) {
          rede++;
        }
      });

      const totalPortas = portas.length;
      const portasOcupadas = portas.filter(p => p.status === 'ocupada').length;
      const totalCabos = cabos.length;
      const conexoesAtivas = conexoesCabos.filter(c => !c.data_desconexao).length;
      const salasComAndar = salas.filter(s => s.andar_id !== null && s.andar_id !== undefined);

      const cards = [
        createCard('fa-boxes', 'fa-cubes', 'Total de Equipamentos', equipamentosRegulares.length, 'Equipamentos regulares', 'from-indigo-500 to-blue-500', null, true),
        createCard('fa-check-circle', 'fa-heart', 'Funcionando', funcionando, 'Sem defeito', 'from-green-500 to-lime-500', null, true),
        createCard('fa-times-circle', 'fa-exclamation-triangle', 'Com Defeito', defeito, 'Precisam de reparo', 'from-red-500 to-pink-500', null, true),
        createCard('fa-bolt', 'fa-plug', 'Total de Fontes', fontes.length, 'Fontes de alimenta√ß√£o', 'from-yellow-500 to-orange-500', null, true),
        createCard('fa-network-wired', 'fa-wifi', 'Dependem de Rede', rede, 'Com IP ou MAC', 'from-purple-500 to-indigo-500', null, true),
        createCard('fa-door-open', 'fa-building', 'Total de Salas', salasComAndar.length, 'Salas cadastradas', 'from-blue-500 to-cyan-500', null, true),
        createCard('fa-ethernet', 'fa-plug', 'Total de Portas', totalPortas, 'Portas de switches', 'from-yellow-500 to-orange-500', null, true),
        createCard('fa-plug', 'fa-link', 'Conex√µes Ativas', conexoesAtivas, 'Cabos conectados', 'from-green-500 to-lime-500', null, true)
      ];

      document.getElementById('cardsOverview').innerHTML = cards.join('');
    }

    function renderEquipamentosCards() {
      const equipamentosRegulares = getFilteredEquipamentos().filter(eq => 
        !eq.tipo || !eq.tipo.toLowerCase().includes('fonte')
      );
      
      const tipos = {};
      equipamentosRegulares.forEach(eq => {
        if (!tipos[eq.tipo]) tipos[eq.tipo] = 0;
        tipos[eq.tipo]++;
      });

      const marcas = {};
      equipamentosRegulares.forEach(eq => {
        if (!marcas[eq.marca]) marcas[eq.marca] = 0;
        marcas[eq.marca]++;
      });

      let funcionando = 0, defeito = 0, indisponivel = 0;
      equipamentosRegulares.forEach(eq => {
        const defeitoValue = parseInt(eq.defeito) || 0;
        if (defeitoValue === 1) {
          defeito++;
        } else if (defeitoValue === 2) {
          indisponivel++;
        } else {
          funcionando++;
        }
      });

      const cards = [
        createCard('fa-boxes', 'fa-cubes', 'Total', equipamentosRegulares.length, 'Equipamentos filtrados', 'from-indigo-500 to-blue-500'),
        createCard('fa-check-circle', 'fa-heart', 'Funcionando', funcionando, `${((funcionando/equipamentosRegulares.length)*100).toFixed(1)}%`, 'from-green-500 to-lime-500'),
        createCard('fa-times-circle', 'fa-exclamation-triangle', 'Com Defeito', defeito, `${((defeito/equipamentosRegulares.length)*100).toFixed(1)}%`, 'from-red-500 to-pink-500'),
        createCard('fa-ban', 'fa-exclamation-triangle', 'Indispon√≠veis', indisponivel, `${((indisponivel/equipamentosRegulares.length)*100).toFixed(1)}%`, 'from-orange-500 to-yellow-500'),
        createCard('fa-tags', 'fa-tag', 'Tipos Diferentes', Object.keys(tipos).length, 'Tipos √∫nicos', 'from-pink-500 to-fuchsia-500'),
        createCard('fa-star', 'fa-star', 'Marcas Diferentes', Object.keys(marcas).length, 'Marcas √∫nicas', 'from-purple-500 to-indigo-500')
      ];

      // Adicionar cards para os tipos mais comuns
      const tiposOrdenados = Object.entries(tipos).sort((a, b) => b[1] - a[1]).slice(0, 6);
      const cores = ['from-blue-500 to-cyan-500', 'from-green-500 to-lime-500', 'from-purple-500 to-indigo-500', 'from-yellow-500 to-orange-500', 'from-red-500 to-pink-500', 'from-emerald-500 to-teal-500'];
      
      tiposOrdenados.forEach(([tipo, quantidade], index) => {
        cards.push(createCard('fa-desktop', 'fa-desktop', tipo, quantidade, `${((quantidade/equipamentosRegulares.length)*100).toFixed(1)}%`, cores[index % cores.length]));
      });

      document.getElementById('cardsEquipamentos').innerHTML = cards.join('');
    }

    function renderSalasCards() {
      const salasComAndar = salas.filter(s => s.andar_id !== null && s.andar_id !== undefined);
      const equipamentosRegulares = getFilteredEquipamentos().filter(eq => 
        !eq.tipo || !eq.tipo.toLowerCase().includes('fonte')
      );

      // Calcular equipamentos por sala
      const eqPorSala = {};
      salasComAndar.forEach(sala => {
        eqPorSala[sala.nome] = 0;
      });
      equipamentosRegulares.forEach(eq => {
        const sala = salasComAndar.find(s => s.id === eq.sala_id);
        if (sala) eqPorSala[sala.nome]++;
      });

      // Calcular salas por andar
      const salasPorAndar = {};
      salasComAndar.forEach(s => {
        const andar = s.andar_id;
        if (!salasPorAndar[andar]) salasPorAndar[andar] = 0;
        salasPorAndar[andar]++;
      });

      const maxEq = Math.max(...Object.values(eqPorSala));
      const minEq = Math.min(...Object.values(eqPorSala));
      const salaMaxEq = Object.entries(eqPorSala).find(([_, qtd]) => qtd === maxEq)?.[0] || '-';
      const salaMinEq = Object.entries(eqPorSala).find(([_, qtd]) => qtd === minEq)?.[0] || '-';
      const maxSalas = Object.values(salasPorAndar).length > 0 ? Math.max(...Object.values(salasPorAndar)) : 0;
      const andarMax = Object.entries(salasPorAndar).find(([_, qtd]) => qtd === maxSalas)?.[0] || '-';

      const cards = [
        createCard('fa-door-open', 'fa-building', 'Total de Salas', salasComAndar.length, 'Salas cadastradas', 'from-blue-500 to-cyan-500'),
        createCard('fa-layer-group', 'fa-layer-group', 'Andar com Mais Salas', maxSalas, `Andar ${andarMax}`, 'from-indigo-500 to-purple-500'),
        createCard('fa-arrow-up', 'fa-arrow-up', 'Sala com Mais Equipamentos', maxEq, salaMaxEq, 'from-green-500 to-lime-500'),
        createCard('fa-arrow-down', 'fa-arrow-down', 'Sala com Menos Equipamentos', minEq, salaMinEq, 'from-red-500 to-pink-500'),
        createCard('fa-calculator', 'fa-calculator', 'M√©dia por Sala', Math.round(equipamentosRegulares.length / salasComAndar.length), 'Equipamentos/sala', 'from-purple-500 to-indigo-500'),
        createCard('fa-chart-bar', 'fa-chart-bar', 'Andares Ocupados', Object.keys(salasPorAndar).length, 'Andares com salas', 'from-yellow-500 to-orange-500')
      ];

      document.getElementById('cardsSalas').innerHTML = cards.join('');
    }

    function renderSwitchesCards() {
      const totalSwitches = switches.length;
      const totalPortas = portas.length;
      const portasOcupadas = portas.filter(p => p.status === 'ocupada').length;
      const portasLivres = portas.filter(p => p.status === 'livre').length;
      const percentualOcupacao = totalPortas > 0 ? ((portasOcupadas / totalPortas) * 100).toFixed(1) : 0;

      // Calcular switches por sala
      const switchesPorSala = {};
      switches.forEach(sw => {
        const sala = salas.find(s => s.id === sw.sala_id);
        if (sala) {
          if (!switchesPorSala[sala.nome]) switchesPorSala[sala.nome] = 0;
          switchesPorSala[sala.nome]++;
        }
      });

      const salaComMaisSwitches = Object.entries(switchesPorSala).length > 0 ? 
        Object.entries(switchesPorSala).sort((a, b) => b[1] - a[1])[0] : ['Nenhuma', 0];

      const cards = [
        createCard('fa-network-wired', 'fa-server', 'Total de Switches', totalSwitches, 'Switches cadastrados', 'from-purple-500 to-indigo-500'),
        createCard('fa-ethernet', 'fa-plug', 'Total de Portas', totalPortas, 'Portas dispon√≠veis', 'from-yellow-500 to-orange-500'),
        createCard('fa-plug', 'fa-bolt', 'Portas Ocupadas', portasOcupadas, `${percentualOcupacao}% ocupa√ß√£o`, 'from-rose-500 to-pink-500'),
        createCard('fa-unlink', 'fa-circle', 'Portas Livres', portasLivres, `${(100 - percentualOcupacao).toFixed(1)}% livres`, 'from-green-500 to-lime-500'),
        createCard('fa-chart-pie', 'fa-chart-pie', 'Taxa de Ocupa√ß√£o', `${percentualOcupacao}%`, 'Portas em uso', 'from-blue-500 to-cyan-500'),
        createCard('fa-building', 'fa-building', 'Sala com Mais Switches', salaComMaisSwitches[1], salaComMaisSwitches[0], 'from-indigo-500 to-purple-500')
      ];

      document.getElementById('cardsSwitches').innerHTML = cards.join('');
    }

    function renderCabosCards() {
      const totalCabos = cabos.length;
      const conexoesAtivas = conexoesCabos.filter(c => !c.data_desconexao).length;
      const conexoesInativas = conexoesCabos.filter(c => c.data_desconexao).length;
      const percentualAtivo = totalCabos > 0 ? ((conexoesAtivas / totalCabos) * 100).toFixed(1) : 0;

      // Contar cabos por tipo
      const cabosPorTipo = {};
      cabos.forEach(cabo => {
        const tipo = cabo.tipo || 'N√£o especificado';
        if (!cabosPorTipo[tipo]) cabosPorTipo[tipo] = 0;
        cabosPorTipo[tipo]++;
      });

      const cards = [
        createCard('fa-plug', 'fa-plug', 'Total de Cabos', totalCabos, 'Cabos cadastrados', 'from-blue-500 to-cyan-500'),
        createCard('fa-link', 'fa-check-circle', 'Conex√µes Ativas', conexoesAtivas, `${percentualAtivo}% ativas`, 'from-green-500 to-lime-500'),
        createCard('fa-unlink', 'fa-times-circle', 'Conex√µes Inativas', conexoesInativas, `${(100 - percentualAtivo).toFixed(1)}% inativas`, 'from-red-500 to-pink-500'),
        createCard('fa-tags', 'fa-tag', 'Tipos Diferentes', Object.keys(cabosPorTipo).length, 'Tipos √∫nicos', 'from-purple-500 to-indigo-500')
      ];

      // Adicionar cards para os tipos mais comuns
      const tiposOrdenados = Object.entries(cabosPorTipo).sort((a, b) => b[1] - a[1]).slice(0, 8);
      const cores = ['from-blue-500 to-cyan-500', 'from-green-500 to-lime-500', 'from-purple-500 to-indigo-500', 'from-yellow-500 to-orange-500', 'from-red-500 to-pink-500', 'from-emerald-500 to-teal-500', 'from-pink-500 to-fuchsia-500', 'from-indigo-500 to-blue-500'];
      
      tiposOrdenados.forEach(([tipo, quantidade], index) => {
        const icone = tipo.includes('Cat') ? 'fa-ethernet' : tipo.includes('Fibra') ? 'fa-circle' : 'fa-plug';
        cards.push(createCard(icone, icone, tipo, quantidade, `${((quantidade/totalCabos)*100).toFixed(1)}%`, cores[index % cores.length]));
      });

      document.getElementById('cardsCabos').innerHTML = cards.join('');
    }

    function renderFontesCards() {
      const fontes = equipamentos.filter(eq => eq.tipo && eq.tipo.toLowerCase().includes('fonte'));
      const fontesFuncionando = fontes.filter(f => !(f.defeito === 1 || f.defeito === true || f.defeito === '1')).length;
      const fontesDefeito = fontes.filter(f => f.defeito === 1 || f.defeito === true || f.defeito === '1').length;
      const percentualFuncionando = fontes.length > 0 ? ((fontesFuncionando / fontes.length) * 100).toFixed(1) : 0;

      // Calcular fontes por sala
      const fontesPorSala = {};
      fontes.forEach(fonte => {
        const sala = salas.find(s => s.id === fonte.sala_id);
        if (sala) {
          if (!fontesPorSala[sala.nome]) fontesPorSala[sala.nome] = 0;
          fontesPorSala[sala.nome]++;
        }
      });

      const salaComMaisFontes = Object.entries(fontesPorSala).length > 0 ? 
        Object.entries(fontesPorSala).sort((a, b) => b[1] - a[1])[0] : ['Nenhuma', 0];

      const cards = [
        createCard('fa-bolt', 'fa-plug', 'Total de Fontes', fontes.length, 'Fontes cadastradas', 'from-yellow-500 to-orange-500'),
        createCard('fa-check-circle', 'fa-heart', 'Funcionando', fontesFuncionando, `${percentualFuncionando}% funcionando`, 'from-green-500 to-lime-500'),
        createCard('fa-times-circle', 'fa-exclamation-triangle', 'Com Defeito', fontesDefeito, `${(100 - percentualFuncionando).toFixed(1)}% com defeito`, 'from-red-500 to-pink-500'),
        createCard('fa-chart-pie', 'fa-chart-pie', 'Taxa de Funcionamento', `${percentualFuncionando}%`, 'Fontes operacionais', 'from-emerald-500 to-teal-500'),
        createCard('fa-building', 'fa-building', 'Sala com Mais Fontes', salaComMaisFontes[1], salaComMaisFontes[0], 'from-indigo-500 to-purple-500'),
        createCard('fa-calculator', 'fa-calculator', 'M√©dia por Sala', Math.round(fontes.length / salas.filter(s => s.andar_id !== null).length), 'Fontes/sala', 'from-purple-500 to-indigo-500')
      ];

      document.getElementById('cardsFontes').innerHTML = cards.join('');
    }

    // Fun√ß√µes de gr√°ficos
    function renderOverviewCharts() {
      const equipamentosRegulares = getFilteredEquipamentos().filter(eq => 
        !eq.tipo || !eq.tipo.toLowerCase().includes('fonte')
      );
      
      // Gr√°fico de status dos equipamentos
      let funcionando = 0, defeito = 0, indisponivel = 0;
      equipamentosRegulares.forEach(eq => {
        const defeitoValue = parseInt(eq.defeito) || 0;
        if (defeitoValue === 1) {
          defeito++;
        } else if (defeitoValue === 2) {
          indisponivel++;
        } else {
          funcionando++;
        }
      });

      if (window.chartStatusOverview && typeof window.chartStatusOverview.destroy === 'function') {
        window.chartStatusOverview.destroy();
      }
      window.chartStatusOverview = new Chart(document.getElementById('chartStatusOverview'), {
        type: 'doughnut',
        data: {
          labels: ['Funcionando', 'Com Defeito', 'Indispon√≠vel'],
          datasets: [{
            data: [funcionando, defeito, indisponivel],
            backgroundColor: ['#10b981', '#ef4444', '#f59e0b'],
          }]
        },
        options: {
          plugins: {
            legend: { labels: { color: '#fff' } }
          }
        }
      });

      // Gr√°fico de distribui√ß√£o por sala
      const salasComAndar = salas.filter(s => s.andar_id !== null && s.andar_id !== undefined);
      const eqPorSala = {};
      salasComAndar.forEach(sala => {
        eqPorSala[sala.nome] = 0;
      });
      equipamentosRegulares.forEach(eq => {
        const sala = salasComAndar.find(s => s.id === eq.sala_id);
        if (sala) eqPorSala[sala.nome]++;
      });

      const salasOrdenadas = Object.entries(eqPorSala)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10); // Top 10 salas

      if (window.chartSalasOverview && typeof window.chartSalasOverview.destroy === 'function') {
        window.chartSalasOverview.destroy();
      }
      window.chartSalasOverview = new Chart(document.getElementById('chartSalasOverview'), {
        type: 'bar',
        data: {
          labels: salasOrdenadas.map(([sala, _]) => sala),
          datasets: [{
            label: 'Equipamentos',
            data: salasOrdenadas.map(([_, qtd]) => qtd),
            backgroundColor: '#6366f1',
          }]
        },
        options: {
          plugins: {
            legend: { display: false },
          },
          scales: {
            x: { ticks: { color: '#fff' } },
            y: { ticks: { color: '#fff' } }
          }
        }
      });
    }

    function renderEquipamentosCharts() {
      const equipamentosRegulares = getFilteredEquipamentos().filter(eq => 
        !eq.tipo || !eq.tipo.toLowerCase().includes('fonte')
      );
      
      // Gr√°fico de tipos
      const tipos = {};
      equipamentosRegulares.forEach(eq => {
        if (!tipos[eq.tipo]) tipos[eq.tipo] = 0;
        tipos[eq.tipo]++;
      });

      const tiposOrdenados = Object.entries(tipos).sort((a, b) => b[1] - a[1]).slice(0, 8);
      const cores = ['#6366f1', '#22d3ee', '#f59e42', '#f43f5e', '#10b981', '#eab308', '#a21caf', '#f87171'];

      if (window.chartTiposEquipamentos && typeof window.chartTiposEquipamentos.destroy === 'function') {
        window.chartTiposEquipamentos.destroy();
      }
      window.chartTiposEquipamentos = new Chart(document.getElementById('chartTiposEquipamentos'), {
        type: 'doughnut',
        data: {
          labels: tiposOrdenados.map(([tipo, _]) => tipo),
          datasets: [{
            data: tiposOrdenados.map(([_, qtd]) => qtd),
            backgroundColor: cores,
          }]
        },
        options: {
          plugins: {
            legend: { labels: { color: '#fff' } }
          }
        }
      });

      // Gr√°fico de marcas
      const marcas = {};
      equipamentosRegulares.forEach(eq => {
        if (!marcas[eq.marca]) marcas[eq.marca] = 0;
        marcas[eq.marca]++;
      });

      const marcasOrdenadas = Object.entries(marcas).sort((a, b) => b[1] - a[1]).slice(0, 8);

      if (window.chartMarcasEquipamentos && typeof window.chartMarcasEquipamentos.destroy === 'function') {
        window.chartMarcasEquipamentos.destroy();
      }
      window.chartMarcasEquipamentos = new Chart(document.getElementById('chartMarcasEquipamentos'), {
        type: 'bar',
        data: {
          labels: marcasOrdenadas.map(([marca, _]) => marca),
          datasets: [{
            label: 'Equipamentos',
            data: marcasOrdenadas.map(([_, qtd]) => qtd),
            backgroundColor: '#a21caf',
          }]
        },
        options: {
          plugins: {
            legend: { display: false },
          },
          scales: {
            x: { ticks: { color: '#fff' } },
            y: { ticks: { color: '#fff' } }
          }
        }
      });
    }

    function renderSalasCharts() {
      const salasComAndar = salas.filter(s => s.andar_id !== null && s.andar_id !== undefined);
      const equipamentosRegulares = getFilteredEquipamentos().filter(eq => 
        !eq.tipo || !eq.tipo.toLowerCase().includes('fonte')
      );

      const eqPorSala = {};
      salasComAndar.forEach(sala => {
        eqPorSala[sala.nome] = 0;
      });
      equipamentosRegulares.forEach(eq => {
        const sala = salasComAndar.find(s => s.id === eq.sala_id);
        if (sala) eqPorSala[sala.nome]++;
      });

      const salasOrdenadas = Object.entries(eqPorSala).sort((a, b) => b[1] - a[1]);

      if (window.chartEquipamentosSalas && typeof window.chartEquipamentosSalas.destroy === 'function') {
        window.chartEquipamentosSalas.destroy();
      }
      window.chartEquipamentosSalas = new Chart(document.getElementById('chartEquipamentosSalas'), {
        type: 'bar',
        data: {
          labels: salasOrdenadas.map(([sala, _]) => sala),
          datasets: [{
            label: 'Equipamentos',
            data: salasOrdenadas.map(([_, qtd]) => qtd),
            backgroundColor: '#10b981',
          }]
        },
        options: {
          plugins: {
            legend: { display: false },
          },
          scales: {
            x: { ticks: { color: '#fff' } },
            y: { ticks: { color: '#fff' } }
          }
        }
      });
    }

    function renderSwitchesCharts() {
      const portasOcupadas = portas.filter(p => p.status === 'ocupada').length;
      const portasLivres = portas.filter(p => p.status === 'livre').length;

      if (window.chartPortasSwitches && typeof window.chartPortasSwitches.destroy === 'function') {
        window.chartPortasSwitches.destroy();
      }
      window.chartPortasSwitches = new Chart(document.getElementById('chartPortasSwitches'), {
        type: 'doughnut',
        data: {
          labels: ['Ocupadas', 'Livres'],
          datasets: [{
            data: [portasOcupadas, portasLivres],
            backgroundColor: ['#ef4444', '#22c55e'],
          }]
        },
        options: {
          plugins: {
            legend: { labels: { color: '#fff' } }
          }
        }
      });

      // Switches por sala
      const switchesPorSala = {};
      switches.forEach(sw => {
        const sala = salas.find(s => s.id === sw.sala_id);
        if (sala) {
          if (!switchesPorSala[sala.nome]) switchesPorSala[sala.nome] = 0;
          switchesPorSala[sala.nome]++;
        }
      });

      const switchesOrdenados = Object.entries(switchesPorSala).sort((a, b) => b[1] - a[1]);

      if (window.chartSwitchesSalas && typeof window.chartSwitchesSalas.destroy === 'function') {
        window.chartSwitchesSalas.destroy();
      }
      window.chartSwitchesSalas = new Chart(document.getElementById('chartSwitchesSalas'), {
        type: 'bar',
        data: {
          labels: switchesOrdenados.map(([sala, _]) => sala),
          datasets: [{
            label: 'Switches',
            data: switchesOrdenados.map(([_, qtd]) => qtd),
            backgroundColor: '#8b5cf6',
          }]
        },
        options: {
          plugins: {
            legend: { display: false },
          },
          scales: {
            x: { ticks: { color: '#fff' } },
            y: { ticks: { color: '#fff' } }
          }
        }
      });
    }

    function renderCabosCharts() {
      // Cabos por tipo
      const cabosPorTipo = {};
      cabos.forEach(cabo => {
        const tipo = cabo.tipo || 'N√£o especificado';
        if (!cabosPorTipo[tipo]) cabosPorTipo[tipo] = 0;
        cabosPorTipo[tipo]++;
      });

      const tiposOrdenados = Object.entries(cabosPorTipo).sort((a, b) => b[1] - a[1]);
      const cores = ['#6366f1', '#22d3ee', '#f59e42', '#f43f5e', '#10b981', '#eab308', '#a21caf', '#f87171'];

      if (window.chartTiposCabos && typeof window.chartTiposCabos.destroy === 'function') {
        window.chartTiposCabos.destroy();
      }
      window.chartTiposCabos = new Chart(document.getElementById('chartTiposCabos'), {
        type: 'doughnut',
        data: {
          labels: tiposOrdenados.map(([tipo, _]) => tipo),
          datasets: [{
            data: tiposOrdenados.map(([_, qtd]) => qtd),
            backgroundColor: cores,
          }]
        },
        options: {
          plugins: {
            legend: { labels: { color: '#fff' } }
          }
        }
      });

      // Status das conex√µes
      const conexoesAtivas = conexoesCabos.filter(c => !c.data_desconexao).length;
      const conexoesInativas = conexoesCabos.filter(c => c.data_desconexao).length;

      if (window.chartStatusCabos && typeof window.chartStatusCabos.destroy === 'function') {
        window.chartStatusCabos.destroy();
      }
      window.chartStatusCabos = new Chart(document.getElementById('chartStatusCabos'), {
        type: 'doughnut',
        data: {
          labels: ['Ativas', 'Inativas'],
          datasets: [{
            data: [conexoesAtivas, conexoesInativas],
            backgroundColor: ['#10b981', '#ef4444'],
          }]
        },
        options: {
          plugins: {
            legend: { labels: { color: '#fff' } }
          }
        }
      });
    }

    function renderFontesCharts() {
      const fontes = equipamentos.filter(eq => eq.tipo && eq.tipo.toLowerCase().includes('fonte'));
      const fontesFuncionando = fontes.filter(f => !(f.defeito === 1 || f.defeito === true || f.defeito === '1')).length;
      const fontesDefeito = fontes.filter(f => f.defeito === 1 || f.defeito === true || f.defeito === '1').length;

      if (window.chartStatusFontes && typeof window.chartStatusFontes.destroy === 'function') {
        window.chartStatusFontes.destroy();
      }
      window.chartStatusFontes = new Chart(document.getElementById('chartStatusFontes'), {
        type: 'doughnut',
        data: {
          labels: ['Funcionando', 'Com Defeito'],
          datasets: [{
            data: [fontesFuncionando, fontesDefeito],
            backgroundColor: ['#10b981', '#ef4444'],
          }]
        },
        options: {
          plugins: {
            legend: { labels: { color: '#fff' } }
          }
        }
      });

      // Gr√°fico de fontes por sala
      const fontesPorSala = {};
      fontes.forEach(fonte => {
        const sala = salas.find(s => s.id === fonte.sala_id);
        if (sala) {
          if (!fontesPorSala[sala.nome]) fontesPorSala[sala.nome] = 0;
          fontesPorSala[sala.nome]++;
        }
      });

      const fontesOrdenadas = Object.entries(fontesPorSala).sort((a, b) => b[1] - a[1]);

      if (window.chartFontesSalas && typeof window.chartFontesSalas.destroy === 'function') {
        window.chartFontesSalas.destroy();
      }
      window.chartFontesSalas = new Chart(document.getElementById('chartFontesSalas'), {
        type: 'bar',
        data: {
          labels: fontesOrdenadas.map(([sala, _]) => sala),
          datasets: [{
            label: 'Fontes',
            data: fontesOrdenadas.map(([_, qtd]) => qtd),
            backgroundColor: '#f59e0b',
          }]
        },
        options: {
          plugins: {
            legend: { display: false },
          },
          scales: {
            x: { ticks: { color: '#fff' } },
            y: { ticks: { color: '#fff' } }
          }
        }
      });
    }

    function renderAnalyticsCharts() {
      const equipamentosRegulares = getFilteredEquipamentos().filter(eq => 
        !eq.tipo || !eq.tipo.toLowerCase().includes('fonte')
      );
      
      // Equipamentos dependentes de rede
      let rede = 0, semRede = 0;
      equipamentosRegulares.forEach(eq => {
        if (eq.dados && (eq.dados.ip1 || eq.dados.mac1 || eq.dados.ip2 || eq.dados.mac2)) {
          rede++;
        } else {
          semRede++;
        }
      });

      if (window.chartRedeAnalytics && typeof window.chartRedeAnalytics.destroy === 'function') {
        window.chartRedeAnalytics.destroy();
      }
      window.chartRedeAnalytics = new Chart(document.getElementById('chartRedeAnalytics'), {
        type: 'doughnut',
        data: {
          labels: ['Dependem de Rede', 'N√£o Dependem'],
          datasets: [{
            data: [rede, semRede],
            backgroundColor: ['#10b981', '#f59e42'],
          }]
        },
        options: {
          plugins: {
            legend: { labels: { color: '#fff' } }
          }
        }
      });

      // Distribui√ß√£o por andar
      const salasComAndar = salas.filter(s => s.andar_id !== null && s.andar_id !== undefined);
      const salasPorAndar = {};
      salasComAndar.forEach(s => {
        const andar = s.andar_id;
        if (!salasPorAndar[andar]) salasPorAndar[andar] = 0;
        salasPorAndar[andar]++;
      });

      const andaresOrdenados = Object.entries(salasPorAndar).sort((a, b) => parseInt(a[0]) - parseInt(b[0]));

      if (window.chartAndaresAnalytics && typeof window.chartAndaresAnalytics.destroy === 'function') {
        window.chartAndaresAnalytics.destroy();
      }
      window.chartAndaresAnalytics = new Chart(document.getElementById('chartAndaresAnalytics'), {
        type: 'bar',
        data: {
          labels: andaresOrdenados.map(([andar, _]) => `Andar ${andar}`),
          datasets: [{
            label: 'Salas',
            data: andaresOrdenados.map(([_, qtd]) => qtd),
            backgroundColor: '#6366f1',
          }]
        },
        options: {
          plugins: {
            legend: { display: false },
          },
          scales: {
            x: { ticks: { color: '#fff' } },
            y: { ticks: { color: '#fff' } }
          }
        }
      });

      // Distribui√ß√£o de equipamentos por status
      let funcionando = 0, defeito = 0, indisponivel = 0;
      equipamentosRegulares.forEach(eq => {
        const defeitoValue = parseInt(eq.defeito) || 0;
        if (defeitoValue === 1) {
          defeito++;
        } else if (defeitoValue === 2) {
          indisponivel++;
        } else {
          funcionando++;
        }
      });

      if (window.chartTendenciasAnalytics && typeof window.chartTendenciasAnalytics.destroy === 'function') {
        window.chartTendenciasAnalytics.destroy();
      }
      window.chartTendenciasAnalytics = new Chart(document.getElementById('chartTendenciasAnalytics'), {
        type: 'bar',
        data: {
          labels: ['Funcionando', 'Com Defeito', 'Indispon√≠vel'],
          datasets: [{
            label: 'Quantidade de Equipamentos',
            data: [funcionando, defeito, indisponivel],
            backgroundColor: ['#10b981', '#ef4444', '#f59e0b'],
          }]
        },
        options: {
          plugins: {
            legend: { 
              display: false,
              labels: { color: '#fff' } 
            }
          },
          scales: {
            x: { ticks: { color: '#fff' } },
            y: { 
              ticks: { color: '#fff' },
              beginAtZero: true
            }
          }
        }
      });
    }

    // Fun√ß√µes auxiliares
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-300 ${
        type === 'success' ? 'bg-green-500 text-white' :
        type === 'error' ? 'bg-red-500 text-white' :
        'bg-blue-500 text-white'
      }`;
      notification.innerHTML = `
        <div class="flex items-center gap-2">
          <i class="fas ${type === 'success' ? 'fa-check' : type === 'error' ? 'fa-times' : 'fa-info'}"></i>
          <span>${message}</span>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    function showCardDetails(title) {
      showNotification(`Detalhes de ${title} - Funcionalidade em desenvolvimento`, 'info');
    }

    function voltarPainelConfig() {
      fetch('/perfil').then(resp => resp.json()).then(perfil => {
        if (perfil.nivel === 'admin') {
          window.location.href = 'config-admin.html';
        } else if (perfil.nivel === 'tecnico') {
          window.location.href = 'config-tecnico.html';
        } else {
          window.location.href = 'config-usuario.html';
        }
      });
    }
  </script>
</body>
</html> 