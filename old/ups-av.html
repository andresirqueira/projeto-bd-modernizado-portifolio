<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor UPS - AV</title>
    <link rel="stylesheet" href="css/estilo-ups.css">
    <link rel="stylesheet" href="css/estilo-index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="js/script.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body onload="carregarUsuario()">
    <header class="header">
        <img src="img/logo-whirlpool.png" alt="Logo da Empresa Esquerda">
        <div class="user-info">
            <span id="welcome-message">Bem-vindo ao Inventory</span>
            <button class="nav-button attention" onclick="window.location.href='home-av.html'" title="Home"><i
                    class="fas fa-house"></i></button>
            <button class="logout-button" onclick="logout()">Sair</button>
        </div>
        <img src="img/logo-convergint.png" alt="Logo da Empresa Direita">
    </header>
    <main id="content" class="content">
        <div class="container">
            <h2>Monitoramento UPS - AV</h2>
            <div class="info-grid">
                <div class="info-item"><i class="fas fa-bolt"></i> UPS Mode: <span id="ups_mode"></span></div>
                <div class="info-item"><i class="fas fa-temperature-high"></i> UPS Temp: <span id="ups_temp"></span>
                    &deg;C</div>
                <div class="info-item"><i class="fas fa-battery-full"></i> UPS Bateria: <span id="ups_battery"></span> %
                </div>
                <div class="info-item"><i class="fas fa-clock"></i> UPS Tempo Restante: <span id="ups_backup"></span>
                    Minutos</div>
                <div class="info-item"><i class="fas fa-calendar-alt"></i> <span id="timestamp"></span></div>
            </div>

            <div class="graph-container">
                <div id="grafico1"></div>
                <div id="grafico2"></div>
                <div id="grafico3"></div>
            </div>
            <div style="text-align: center;">
                <button class="botao-pdf" id="save-pdf">Salvar em PDF</button>
            </div>
            <button class="botao-voltar" onclick="window.history.back()">Voltar</button>
        </div>
    </main>
    <footer class="footer">
        <img src="img/footer-logo.png" alt="Logo do Rodapé">
    </footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetch('dados_ups.json')
                .then(response => response.json())
                .then(data => {
                    document.getElementById("ups_mode").textContent = data.ups_mode;
                    document.getElementById("ups_temp").textContent = data.ups_temp;
                    document.getElementById("ups_battery").textContent = data.ups_battery;
                    document.getElementById("ups_backup").textContent = data.ups_backup;
                    document.getElementById("timestamp").textContent = data.timestamp;

                    var layout = {
                        title: 'Tensão de Entrada',
                        xaxis: { title: 'Fases' },
                        yaxis: { title: 'Tensão (V)' },
                        barmode: 'group',
                        width: 400,
                        height: 300,
                        paper_bgcolor: '#rgb(18, 33, 55)', // Cor de fundo do "papel" (área externa ao gráfico)
                        plot_bgcolor: '#rgb(18, 33, 55)',
                        font: {
                            family: 'Arial, sans-serif',
                            size: 14,
                            color: '#ffcc00' // <- Cor da fonte
                        }


                    };

                    var layout2 = {
                        title: 'Corrente de Saída',
                        xaxis: { title: 'Fases' },
                        yaxis: { title: 'Corrente (A)' },
                        barmode: 'group',
                        width: 400,
                        height: 300,
                        paper_bgcolor: 'rgb(18, 33, 55)',// Cor de fundo do "papel" (área externa ao gráfico)
                        plot_bgcolor: '#rgb(18, 33, 55)',
                        font: {
                            family: 'Arial, sans-serif',
                            size: 14,
                            color: '#ffcc00'// <- Cor da fonte
                        }

                    };
                    Plotly.newPlot('grafico1', [{
                        x: ['L1', 'L2', 'L3'],
                        y: data.entrada,
                        type: 'bar',
                        text: data.entrada,
                        textposition: 'auto',
                        marker: {
                            color: ['#FF6347', '#87CEFA', '#3CB371']// L1, L2, L3
                        }

                    }], layout);

                    layout.title = 'Tensão de Saída';
                    Plotly.newPlot('grafico2', [{
                        x: ['L1', 'L2', 'L3'],
                        y: data.saida,
                        type: 'bar',
                        text: data.saida,
                        textposition: 'auto',
                        marker: {
                            color: ['#FF6347', '#87CEFA', '#3CB371']// L1, L2, L3
                        }

                    }], layout);

                    layout.title = 'Corrente de Saída';
                    Plotly.newPlot('grafico3', [{
                        x: ['L1', 'L2', 'L3'],
                        y: data.corrente,
                        type: 'bar',
                        text: data.corrente,
                        textposition: 'auto',
                        marker: {
                            color: ['#FF6347', '#87CEFA', '#3CB371'] // L1, L2, L3
                        }

                    }], layout2);
                });

            document.getElementById("save-pdf").addEventListener("click", function () {
                var element = document.getElementById("content");
                var filename = "dados_UPS_AV_" + new Date().toISOString().replace(/[:.]/g, '-') + ".pdf";
                html2pdf().set({
                    margin: 1,
                    filename: filename,
                    image: { type: "jpeg", quality: 0.98 },
                    html2canvas: { scale: 3 },
                    jsPDF: { unit: "in", format: [16, 11], orientation: "landscape" }
                }).from(element).save();
            });

        });
    </script>
</body>

</html>