<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Adicionar Equipamento</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = { darkMode: 'class' };
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="static/img/favicon-mais.png">
    <script>
      function toggleDarkMode() {
        if (document.documentElement.classList.contains('dark')) {
          document.documentElement.classList.remove('dark');
          localStorage.setItem('theme', 'light');
        } else {
          document.documentElement.classList.add('dark');
          localStorage.setItem('theme', 'dark');
        }
        // Atualizar logo da empresa quando o tema mudar
        updateEmpresaLogo();
      }
      if (localStorage.getItem('theme') === 'dark') {
        document.documentElement.classList.add('dark');
      } else if (localStorage.getItem('theme') === 'light') {
        document.documentElement.classList.remove('dark');
      }
    </script>
</head>

<body class="bg-gradient-to-br from-indigo-400 to-purple-600 min-h-screen dark:bg-gradient-to-br dark:from-gray-900 dark:to-gray-800">
    <div class="relative w-full max-w-4xl mx-auto bg-white dark:bg-gray-900 rounded-xl shadow-2xl p-8 mt-8">
        <button onclick="window.location.href='config-admin.html'" class="absolute top-4 left-4 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-full p-2 transition-colors" title="Voltar">
            <i class="fas fa-arrow-left text-gray-700 dark:text-gray-300"></i>
        </button>
        <div id="empresa-logada" class="absolute top-4 right-4 text-indigo-500 font-bold bg-gray-800 dark:bg-transparent rounded-lg p-2"></div>
        <button onclick="toggleDarkMode()" class="absolute top-4 left-16 bg-gray-200 dark:bg-gray-700 rounded-full p-2 transition-colors" title="Alternar modo escuro">
            <span class="dark:hidden">üåô</span><span class="hidden dark:inline">‚òÄÔ∏è</span>
        </button>
        <div class="text-center mt-8 mb-8">
            <div class="text-center mt-8 mb-8">
            <h1 class="text-3xl font-bold text-gray-800 dark:text-white mb-4">
                <i class="fas fa-plus text-indigo-600 dark:text-indigo-400 mr-3"></i>
                Adicionar Equipamento
            </h1>
            <p class="text-gray-600 dark:text-gray-300">Cadastre um novo equipamento no sistema</p>
        </div>
        </div>
        <form id="formEquipamento" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="md:col-span-2">
                <label class="block text-gray-700 dark:text-gray-200 font-semibold mb-2">Nome:</label>
                <input type="text" name="nome" required class="w-full px-4 py-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 dark:bg-gray-800 dark:text-white dark:border-gray-600">
            </div>
            <div>
                <label class="block text-gray-700 dark:text-gray-200 font-semibold mb-2">Tipo:</label>
                <select name="tipo" id="tipo" required class="w-full px-4 py-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 dark:bg-gray-800 dark:text-white dark:border-gray-600">
                    <option value="">Selecione...</option>
                    <option value="Projetor">Projetor</option>
                    <option value="TV">TV</option>
                    <option value="Tela Led">Tela Led</option>
                    <option value="Tap">Tap</option>
                    <option value="Microfone">Microfone</option>
                    <option value="Speaker">Speaker</option>
                    <option value="Camera">Camera</option>
                    <option value="Meetup">Meetup</option>
                    <option value="Painel">Painel</option>
                    <option value="Sensor">Sensor</option>
                    <option value="PC">PC</option>
                    <option value="Hub">Hub</option>
                    <option value="Clickshare">Clickshare</option>
                    <option value="AVIO">AVIO</option>
                    <option value="Extensores">Extensores</option>
                    <option value="Dongle">Dongle</option>
                    <option value="Switcher">Switcher</option>
                    <option value="Serial">Serial</option>
                    <option value="Antena">Antena</option>
                    <option value="Mixer">Mixer</option>
                    <option value="Amplificador">Amplificador</option>
                    <option value="Receptor">Receptor</option>
                    <option value="Poe">Injetor Poe</option>
                    <option value="Adaptador">Adaptador</option>
                    <option value="Outro">Outro</option>
                </select>
            </div>
            <div>
                <label class="block text-gray-700 dark:text-gray-200 font-semibold mb-2">Marca:</label>
                <select name="marca" id="marca" required class="w-full px-4 py-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 dark:bg-gray-800 dark:text-white dark:border-gray-600">
                    <option value="">Selecione o tipo primeiro</option>
                </select>
            </div>
            <div>
                <label class="block text-gray-700 dark:text-gray-200 font-semibold mb-2">Modelo:</label>
                <select name="modelo" id="modelo" class="w-full px-4 py-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 dark:bg-gray-800 dark:text-white dark:border-gray-600">
                    <option value="">Selecione a marca primeiro</option>
                </select>
            </div>
            <div>
                <label class="block text-gray-700 dark:text-gray-200 font-semibold mb-2">Part Number:</label>
                <input type="text" name="partnumber" class="w-full px-4 py-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 dark:bg-gray-800 dark:text-white dark:border-gray-600">
            </div>
            <div>
                <label class="block text-gray-700 dark:text-gray-200 font-semibold mb-2">Tamanho:</label>
                <input type="text" name="tamanho" class="w-full px-4 py-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 dark:bg-gray-800 dark:text-white dark:border-gray-600">
            </div>
            <div class="md:col-span-2">
                <label class="block text-gray-700 dark:text-gray-200 font-semibold mb-2">Descri√ß√£o:</label>
                <input type="text" name="descricao" class="w-full px-4 py-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 dark:bg-gray-800 dark:text-white dark:border-gray-600">
            </div>
            <div>
                <label class="block text-gray-700 dark:text-gray-200 font-semibold mb-2">Firmware:</label>
                <input type="text" name="firmware" class="w-full px-4 py-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 dark:bg-gray-800 dark:text-white dark:border-gray-600">
            </div>
            <div>
                <label class="block text-gray-700 dark:text-gray-200 font-semibold mb-2">N√∫mero de S√©rie:</label>
                <input type="text" name="serie" class="w-full px-4 py-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 dark:bg-gray-800 dark:text-white dark:border-gray-600">
            </div>
            <div>
                <label class="block text-gray-700 dark:text-gray-200 font-semibold mb-2">IP 1:</label>
                <input type="text" name="ip1" class="w-full px-4 py-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 dark:bg-gray-800 dark:text-white dark:border-gray-600">
            </div>
            <div>
                <label class="block text-gray-700 dark:text-gray-200 font-semibold mb-2">MAC 1:</label>
                <input type="text" name="mac1" class="w-full px-4 py-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 dark:bg-gray-800 dark:text-white dark:border-gray-600">
            </div>
            <div>
                <label class="block text-gray-700 dark:text-gray-200 font-semibold mb-2">IP 2:</label>
                <input type="text" name="ip2" class="w-full px-4 py-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 dark:bg-gray-800 dark:text-white dark:border-gray-600">
            </div>
            <div>
                <label class="block text-gray-700 dark:text-gray-200 font-semibold mb-2">MAC 2:</label>
                <input type="text" name="mac2" class="w-full px-4 py-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 dark:bg-gray-800 dark:text-white dark:border-gray-600">
            </div>
            <div class="md:col-span-2">
                <label class="block text-gray-700 dark:text-gray-200 font-semibold mb-2">Sala:</label>
                <select name="sala_id" id="sala_id" class="w-full px-4 py-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 dark:bg-gray-800 dark:text-white dark:border-gray-600">
                    <option value="">Sem sala</option>
                </select>
            </div>
            <div class="md:col-span-2 flex justify-center mt-8">
                <button type="submit" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-8 rounded-lg shadow flex items-center gap-2 transition-colors text-lg">
                    <i class="fas fa-plus"></i> Adicionar Equipamento
                </button>
            </div>
        </form>
        <div class="msg text-center mt-6 text-lg font-semibold" id="msg"></div>
    </div>
    <script>
        // Carregar salas para o select
        async function carregarSalas() {
            const resp = await fetch('/salas');
            const salas = await resp.json();
            const select = document.getElementById('sala_id');
            salas.forEach(sala => {
                const opt = document.createElement('option');
                opt.value = sala.id;
                opt.textContent = sala.nome;
                select.appendChild(opt);
            });
        }
        carregarSalas();

        // Marcas por tipo
        const marcasPorTipo = {
            Projetor: ["Epson", "Outro"],
            TV: ["LG", "Sony", "Outro"],
            Tap: ["Logitech", "Outro"],
            Microfone: ["Shure", "Logitech", "Jabra", "Outro"],
            Speaker: ["JBL", "Shure", "Logitech", "Outro"],
            Camera: ["Logitech", "Huddly", "Yealink", "Jabra", "Outro"],
            Meetup: ["Logitech", "Outro"],
            Painel: ["Crestron", "Outro"],
            Sensor: ["Crestron", "Outro"],
            PC: ["CTL", "Asus", "BlueTech", "Outro"],
            Hub: ["Logitech", "Outro"],
            Clickshare: ["Barco", "Outro"],
            AVIO: ["Dante", "Outro"],
            Extensores: ["Extron", "Outro"],
            Dongle: ["Logitech", "Outro"],
            "Tela Led": ["LG", "Leyard", "Outro"],
            Switcher: ["Kramer", "Outro"],
            Serial: ["Controlart", "Outro"],
            Antena: ["Shure", "Outro"],
            Mixer: ["Shure", "Outro"],
            Amplificador: ["QSC", "Outro"],
            Receptor: ["Shure", "Outro"],
            Poe: ["Logitech", "Outro"],
            Adaptador: ["Kramer", "Outro"],
            Outro: ["Outro"]
        };

        // Modelos por tipo+marca
        const modelosPorTipoMarca = {
            Projetor: {
                Epson: ["PowerLite X41+", "Outro"],
                Outro: ["Outro"]
            },
            TV: {
                LG: ["32LM621CBSB", "50UP751C0SF", "55UN731C0SC", "55UP751C0SF","75UN801C0SB", "75UP801C0SB", "82UN8000PSB", "50UL3G-BJ","43UN731C0SC","50UN731C0SC","32SM5KE-BJ","Outro"],
                Sony: ["Bravia", "Outro"],
                Outro: ["Outro"]
            },
            "Tela Led": {
                LG: ["LG", "Outro"],
                Leyard: ["Leyard", "Outro"],
                Outro: ["Outro"]
            },
            Tap: {
                Logitech: ["Tap Poe", "Tap USB", "Outro"],
                Outro: ["Outro"]
            },
            Microfone: {
                Shure: ["MXA710", "MXA910", "MXA920", "SM58", "BLX1", "Outro"],
                Logitech: ["Rally Mic Pod", "Outro"],
                Jabra: ["Jabra Speak", "Outro"],
                Outro: ["Outro"]
            },
            Speaker: {
                JBL: ["JBL CBT 1000E", "Outro"],
                Logitech: ["Rally", "Outro"],
                Shure: ["MXN5W-C", "Outro"],
                Outro: ["Outro"]
            },
            Camera: {
                Logitech: ["Rally", "Outro"],
                Huddly: ["Huddly Go", "Outro"],
                Yealink: ["Yealink W52P", "Outro"],
                Jabra: ["Panacast", "Outro"],
                Outro: ["Outro"]
            },
            Meetup: {
                Logitech: ["Meetup", "Outro"],
                Outro: ["Outro"]
            },
            Painel: {
                Crestron: ["TSW-770-B-S", "TSW-770-W-S", "Outro"],
                Outro: ["Outro"]
            },
            Sensor: {
                Crestron: ["CEN-ODT-C-POE", "Outro"],
                Outro: ["Outro"]
            },
            PC: {
                CTL: ["CTL-1000", "Outro"],
                Asus: ["Asus", "Outro"],
                BlueTech: ["BlueTech", "Outro"],
                Outro: ["Outro"]
            },
            Hub: {
                Logitech: ["Display", "Table", "Outro"],
                Outro: ["Outro"]
            },
            Clickshare: {
                Barco: ["C5", "C10", "CSE-200", "Outro"],
                Outro: ["Outro"]
            },
            AVIO: {
                Dante: ["2CH USB IO Adapter", "2CH Analog Output Adapter", "1CH Analog Input Adapter", "1CH Analog Output Adapter", "2CH Analog Input Adapter", "Outro"],
                Outro: ["Outro"]
            },
            Extensores: {
                Extron: ["DTP HDMI 230 Tx", "USB EXTENDER Plus T", "Outro"],
                Outro: ["Outro"]
            },
            Dongle: {
                Logitech: ["Logitech", "Outro"],
                Outro: ["Outro"]
            },
            "Tela Led": {
                LG: ["LG", "Outro"],
                Leyard: ["Leyard", "Outro"],
                Outro: ["Outro"]
            },
            Switcher: {
                Kramer: ["HDMI VS-211H2", "Outro"],
                Outro: ["Outro"]
            },
            Serial: {
                Controlart: ["rs-232"]
            },
            Antena: {
                Shure: ["UA864", "Outro"],
                Outro: ["Outro"]
            },
            Mixer: {
                Shure: ["ANI22", "Outro"],
                Outro: ["Outro"]
            },
            Amplificador: {
                QSC: ["DPA4.2Q", "Outro"],
                Outro: ["Outro"]
            },
            Receptor: {
                Shure: ["ULXD4Q", "Outro"],
                Outro: ["Outro"]
            },
            Poe: {
                Logitech: ["KIT CAT5E", "Outro"],
                Outro: ["Outro"]
            },
            Adaptador: {
                Kramer: ["HDMI F to HDMI F", "Outro"],
                Outro: ["USBA F to USBA F","Outro"]
            },
            Outro: {
                Outro: ["Outro"]
            }
        };

        document.getElementById('tipo').addEventListener('change', function () {
            const tipo = this.value;
            const marcaSelect = document.getElementById('marca');
            marcaSelect.innerHTML = "";
            if (marcasPorTipo[tipo]) {
                marcaSelect.innerHTML = '<option value="">Selecione...</option>';
                marcasPorTipo[tipo].forEach(marca => {
                    const opt = document.createElement('option');
                    opt.value = marca;
                    opt.textContent = marca;
                    marcaSelect.appendChild(opt);
                });
            } else {
                marcaSelect.innerHTML = '<option value="">Selecione o tipo primeiro</option>';
            }
            // Limpa modelos ao trocar tipo
            const modeloSelect = document.getElementById('modelo');
            modeloSelect.innerHTML = '<option value="">Selecione a marca primeiro</option>';
        });

        document.getElementById('marca').addEventListener('change', function () {
            const tipo = document.getElementById('tipo').value;
            const marca = this.value;
            const modeloSelect = document.getElementById('modelo');
            modeloSelect.innerHTML = "";
            if (modelosPorTipoMarca[tipo] && modelosPorTipoMarca[tipo][marca]) {
                modeloSelect.innerHTML = '<option value="">Selecione...</option>';
                modelosPorTipoMarca[tipo][marca].forEach(modelo => {
                    const opt = document.createElement('option');
                    opt.value = modelo;
                    opt.textContent = modelo;
                    modeloSelect.appendChild(opt);
                });
            } else {
                modeloSelect.innerHTML = '<option value="">Selecione a marca primeiro</option>';
            }
        });

        document.getElementById('formEquipamento').onsubmit = async function (e) {
            e.preventDefault();
            const form = e.target;
            const dados = {
                nome: form.nome.value,
                tipo: form.tipo.value,
                marca: form.marca.value,
                modelo: form.modelo.value,
                descricao: form.descricao.value,
                sala_id: form.sala_id.value || null,
                dados: {
                    firmware: form.firmware.value,
                    serie: form.serie.value,
                    ip1: form.ip1.value,
                    mac1: form.mac1.value,
                    ip2: form.ip2.value,
                    mac2: form.mac2.value,
                    partnumber: form.partnumber.value,
                    tamanho: form.tamanho.value
                }
            };
            const resp = await fetch('/equipamentos', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dados)
            });
            const json = await resp.json();
            if (json.status === 'ok') {
                document.getElementById('msg').innerText = 'Equipamento adicionado com sucesso!';
                form.reset();
            } else {
                document.getElementById('msg').innerText = 'Erro ao adicionar equipamento!';
            }
        };

        window.addEventListener('DOMContentLoaded', function() {
            fetch('/empresa_atual')
                .then(resp => resp.json())
                .then(data => {
                    LogoManager.loadEmpresaLogo(data);
                });
        });
    </script>
    <script src="static/js/logo-manager.js"></script>
    </body>

</html>