<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Excluir Sala</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = { darkMode: 'class' };
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="static/img/favicon-lixeira.png">
    <script>
      function toggleDarkMode() {
        if (document.documentElement.classList.contains('dark')) {
          document.documentElement.classList.remove('dark');
          localStorage.setItem('theme', 'light');
        } else {
          document.documentElement.classList.add('dark');
          localStorage.setItem('theme', 'dark');
        }
        // Atualizar logo da empresa quando o tema mudar
        updateEmpresaLogo();
      }
      if (localStorage.getItem('theme') === 'dark') {
        document.documentElement.classList.add('dark');
      } else if (localStorage.getItem('theme') === 'light') {
        document.documentElement.classList.remove('dark');
      }
    </script>
</head>
<body class="bg-gradient-to-br from-indigo-400 to-purple-600 min-h-screen dark:bg-gradient-to-br dark:from-gray-900 dark:to-gray-800">
    <div class="relative w-full max-w-5xl mx-auto bg-white dark:bg-gray-900 rounded-xl shadow-2xl p-8 mt-8">
        <button onclick="window.location.href='config-admin.html'" class="absolute top-4 left-4 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-full p-2 transition-colors" title="Voltar">
            <i class="fas fa-arrow-left text-gray-700 dark:text-gray-300"></i>
        </button>
        <div id="empresa-logada" class="absolute top-4 right-4 text-indigo-500 font-bold bg-gray-800 dark:bg-transparent rounded-lg p-2"></div>
        <button onclick="toggleDarkMode()" class="absolute top-4 left-16 bg-gray-200 dark:bg-gray-700 rounded-full p-2 transition-colors" title="Alternar modo escuro">
            <span class="dark:hidden">üåô</span><span class="hidden dark:inline">‚òÄÔ∏è</span>
        </button>
        <h1 class="text-3xl font-bold text-gray-800 dark:text-white text-center mb-8">Excluir Sala</h1>
        <div class="flex flex-col gap-4 mb-6">
            <input id="filtroSala" type="text" class="px-4 py-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 dark:bg-gray-800 dark:text-white w-full max-w-md mx-auto" placeholder="Filtrar por nome da sala...">
            <div id="cardsSalasContainer" class="flex flex-wrap gap-6 justify-center"></div>
        </div>
        <div class="msg text-center mt-4 text-lg font-semibold" id="msg"></div>
    </div>
    <script>
    let todasSalas = [];
    async function carregarSalas() {
        const resp = await fetch('/salas');
        const salas = await resp.json();
        todasSalas = salas;
        renderizarCards(salas);
    }
    function renderizarCards(salas) {
        const container = document.getElementById('cardsSalasContainer');
        let html = '';
        for (const sala of salas) {
            html += `<div class='bg-gray-100 dark:bg-gray-800 rounded-xl shadow-lg p-6 flex flex-col items-center w-64 min-h-[220px]'>`;
            if (sala.foto) {
                html += `<div class='mb-3'><img src='${sala.foto.startsWith('img/') ? 'static/' + sala.foto : sala.foto}' alt='${sala.nome || ''}' class='rounded-md object-cover max-w-[180px] max-h-[90px]'></div>`;
            }
            html += `<div class='font-bold text-lg text-gray-800 dark:text-white mb-2 text-center'>${sala.nome}</div>`;
            html += `<div class='flex-1'></div>`;
            html += `<button class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-6 rounded-lg shadow flex items-center gap-2 transition-colors text-base mt-2" onclick="excluirSala(${sala.id}, this)"><i class="fas fa-trash-alt"></i> Excluir</button>`;
            html += `</div>`;
        }
        container.innerHTML = html;
    }
    document.addEventListener('DOMContentLoaded', function() {
        const filtro = document.getElementById('filtroSala');
        filtro.addEventListener('input', function() {
            const termo = filtro.value.trim().toLowerCase();
            const filtradas = termo ? todasSalas.filter(s => (s.nome||'').toLowerCase().includes(termo)) : todasSalas;
            renderizarCards(filtradas);
        });
        fetch('/empresa_atual')
            .then(resp => resp.json())
            .then(data => {
                LogoManager.loadEmpresaLogo(data);
            });
    });

    async function excluirSala(id, btn) {
        // Buscar equipamentos vinculados
        const respEq = await fetch(`/equipamentos?sala_id=${id}`);
        const equipamentos = await respEq.json();
        let msg = '';
        if (equipamentos.length > 0) {
            msg = `Aten√ß√£o! Os seguintes equipamentos est√£o vinculados a esta sala e ser√£o desvinculados:\n\n`;
            msg += equipamentos.map(eq => `- ${eq.nome}${eq.modelo ? ' (' + eq.modelo + ')' : ''}`).join('\n');
            msg += `\n\nEles ficar√£o dispon√≠veis para vincular a outras salas.`;
        } else {
            msg = 'Tem certeza que deseja excluir esta sala?';
        }
        if (!confirm(msg)) return;
        const resp = await fetch(`/salas/${id}`, { method: 'DELETE' });
        const json = await resp.json();
        if (json.status === 'ok') {
            btn.closest('.bg-gray-100, .dark\:bg-gray-800').remove();
            document.getElementById('msg').innerText = 'Sala exclu√≠da com sucesso!';
        } else {
            document.getElementById('msg').innerText = 'Erro ao excluir sala!';
        }
    }

    carregarSalas();
    </script>
    <script src="static/js/logo-manager.js"></script>
    </body>
</html> 