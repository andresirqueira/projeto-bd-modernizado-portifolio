<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Painel</title>
    <link rel="icon" type="image/png" href="static/img/favicon-dashboard.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { darkMode: 'class' };
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="static/js/demo-banner.js"></script>
    <script>
        // Dark mode toggle
        function toggleDarkMode() {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            } else {
                document.documentElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
            // Atualizar logo da empresa quando o tema mudar
            updateEmpresaLogo();
        }
        
        function updateEmpresaLogo() {
            const empresaDiv = document.getElementById('empresa-logada');
            if (empresaDiv && empresaDiv.querySelector('img')) {
                const isDark = document.documentElement.classList.contains('dark');
                const bgClass = isDark ? 'dark:bg-transparent' : 'bg-gray-800';
                empresaDiv.className = `absolute top-4 right-4 text-indigo-500 font-bold ${bgClass} rounded-lg p-2`;
            }
        }
        
        // Persist theme on load
        if (localStorage.getItem('theme') === 'dark') {
            document.documentElement.classList.add('dark');
        } else if (localStorage.getItem('theme') === 'light') {
            document.documentElement.classList.remove('dark');
        }
    </script>
</head>

<body
    class="bg-gradient-to-br from-indigo-400 to-purple-600 min-h-screen flex items-center justify-center dark:bg-gradient-to-br dark:from-gray-900 dark:to-gray-800">
    <div class="relative w-full max-w-xl bg-white dark:bg-gray-900 rounded-xl shadow-2xl p-10 text-center min-h-[500px] flex flex-col justify-center h-full">
        <button onclick="toggleDarkMode()" class="absolute top-4 left-4 bg-gray-200 dark:bg-gray-700 rounded-full p-2 transition-colors" title="Alternar modo escuro">
            <span class="dark:hidden">üåô</span><span class="hidden dark:inline">‚òÄÔ∏è</span>
        </button>
        <div id="empresa-logada" class="absolute top-4 right-4 text-indigo-500 font-bold bg-gray-800 dark:bg-transparent rounded-lg p-2"></div>
        <h1 id="tituloPainel" class="text-3xl font-bold text-gray-800 dark:text-white mb-2 flex-shrink-0">
            <i class="fas fa-tachometer-alt text-indigo-600 dark:text-indigo-400 mr-3"></i>
            Painel
        </h1>
        <p id="boasVindas" class="text-gray-600 dark:text-gray-300 mb-4 flex-shrink-0"></p>
        <div class="flex flex-wrap gap-4 justify-center mt-6 flex-shrink-0">
            <button id="btnAdmin"
                class="hidden bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg shadow flex items-center gap-2 transition-colors"
                onclick="window.location.href='config-admin.html'">
                <i class="fas fa-user-shield"></i>Configura√ß√µes de Admin
            </button>
            <button id="btnTecnico"
                class="hidden bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-6 rounded-lg shadow flex items-center gap-2 transition-colors"
                onclick="window.location.href='config-tecnico.html'">
                <i class="fas fa-tools"></i>Ferramentas T√©cnicas
            </button>
            <button id="btnUsuario"
                class="hidden bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow flex items-center gap-2 transition-colors"
                onclick="window.location.href='config-usuario.html'">
                <i class="fas fa-user"></i>Acesso Usu√°rio
            </button>
            <button
                class="bg-red-500 hover:bg-red-600 text-white font-semibold py-3 px-6 rounded-lg shadow flex items-center gap-2 transition-colors"
                onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Sair
            </button>
        </div>
    </div>
    <script>
        async function carregarPerfil() {
            const resp = await fetch('/perfil');
            const perfil = await resp.json();
            if (!perfil.nivel) {
                window.location.href = '/login.html';
                return;
            }
            document.getElementById('boasVindas').innerText = `Bem-vindo, ${perfil.nivel}!`;
            // Personaliza√ß√£o dos bot√µes conforme o n√≠vel
            if (perfil.nivel === 'admin') {
                document.getElementById('btnAdmin').classList.remove('hidden');
                document.getElementById('tituloPainel').innerText = 'Painel do Administrador';
            } else if (perfil.nivel === 'tecnico') {
                document.getElementById('btnTecnico').classList.remove('hidden');
                document.getElementById('tituloPainel').innerText = 'Painel do T√©cnico';
            } else {
                document.getElementById('btnUsuario').classList.remove('hidden');
                document.getElementById('tituloPainel').innerText = 'Painel do Usu√°rio';
            }
        }
        function logout() {
            fetch('/logout').then(() => window.location.href = '/login.html');
        }
        carregarPerfil();
        window.addEventListener('DOMContentLoaded', function() {
            fetch('/empresa_atual')
                .then(resp => resp.json())
                .then(data => {
                    const empresaDiv = document.getElementById('empresa-logada');
                    if (data.logo) {
                        // Aplicar classes baseadas no tema atual
                        const isDark = document.documentElement.classList.contains('dark');
                        const bgClass = isDark ? 'dark:bg-transparent' : 'bg-gray-800';
                        empresaDiv.className = `absolute top-4 right-4 text-indigo-500 font-bold ${bgClass} rounded-lg p-2`;
                        empresaDiv.innerHTML = `<img src="${data.logo}" alt="Logo da empresa" style="max-height:40px;max-width:120px;object-fit:contain;">`;
                    } else if (data.nome) {
                        empresaDiv.innerText = 'Empresa: ' + data.nome;
                    }
                });
        });
    </script>
</body>

</html>