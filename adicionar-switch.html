<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Adicionar Switch</title>
    <link rel="stylesheet" href="css/estilo-base.css">
    <link rel="stylesheet" href="css/estilo-adicionar-switch.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="admin-container">
        <div class="voltar-container">
            <button class="card-btn voltar" onclick="window.location.href='config-admin.html'" title="Voltar">
                <i class="fas fa-arrow-left"></i>
            </button>
        </div>
        <h1>Adicionar Switch</h1>
        <div id="empresa-logada"></div>
        <form id="formSwitch" class="form-switch">
            <div class="form-group">
                <label for="nome">Nome:</label>
                <input type="text" name="nome" id="nome" required placeholder="Digite o nome do switch">
            </div>
            <div class="form-group">
                <label for="marca">Marca:</label>
                <select name="marca" id="marca" required>
                    <option value="">Selecione a marca...</option>
                    <option value="Cisco">Cisco</option>
                    <option value="HP">HP</option>
                    <option value="Dell">Dell</option>
                    <option value="Juniper">Juniper</option>
                    <option value="Aruba">Aruba</option>
                    <option value="Netgear">Netgear</option>
                    <option value="TP-Link">TP-Link</option>
                    <option value="Ubiquiti">Ubiquiti</option>
                    <option value="Mikrotik">Mikrotik</option>
                    <option value="Outro">Outro</option>
                </select>
            </div>
            <div class="form-group">
                <label for="modelo">Modelo:</label>
                <select name="modelo" id="modelo" required>
                    <option value="">Selecione a marca primeiro</option>
                </select>
            </div>
            <div class="btn-container">
                <button type="submit" class="btn-salvar">
                    <i class="fas fa-plus"></i> Adicionar Switch
                </button>
            </div>
        </form>
        <div class="msg" id="msg"></div>
    </div>

    <script>
        // Modelos por marca
        const modelosPorMarca = {
            Cisco: [
                "Catalyst 2960",
                "Catalyst 3560",
                "Catalyst 3750",
                "Catalyst 3850",
                "Catalyst 4500",
                "Catalyst 6500",
                "Nexus 3000",
                "Nexus 5000",
                "Nexus 7000",
                "Nexus 9000",
                "Outro"
            ],
            HP: [
                "ProCurve 1800",
                "ProCurve 2500",
                "ProCurve 2600",
                "ProCurve 2800",
                "ProCurve 2900",
                "ProCurve 3500",
                "ProCurve 5400",
                "Aruba 2530",
                "Aruba 2930",
                "Aruba 3810",
                "Outro"
            ],
            Dell: [
                "PowerConnect 2800",
                "PowerConnect 3500",
                "PowerConnect 5500",
                "PowerConnect 6200",
                "PowerConnect 7000",
                "N-Series",
                "S-Series",
                "Z-Series",
                "Outro"
            ],
            Juniper: [
                "EX2200",
                "EX2300",
                "EX3300",
                "EX3400",
                "EX4300",
                "EX4500",
                "EX4600",
                "EX9200",
                "QFX5100",
                "QFX5200",
                "Outro"
            ],
            Aruba: [
                "2530",
                "2930",
                "3810",
                "5400",
                "8320",
                "8400",
                "Outro"
            ],
            Netgear: [
                "GS108",
                "GS116",
                "GS724T",
                "GS748T",
                "GS752TP",
                "M4100",
                "M4300",
                "Outro"
            ],
            "TP-Link": [
                "TL-SG1008",
                "TL-SG1016",
                "TL-SG1024",
                "TL-SG108",
                "TL-SG116",
                "TL-SG2008",
                "TL-SG2016",
                "Outro"
            ],
            Ubiquiti: [
                "US-8",
                "US-16-150W",
                "US-24",
                "US-24-250W",
                "US-48",
                "US-48-500W",
                "USW-Enterprise-24-POE",
                "Outro"
            ],
            Mikrotik: [
                "CRS125-24G-1S",
                "CRS226-24G-2S",
                "CRS328-24P-4S",
                "CRS354-48G-4S",
                "CSS326-24G-2S",
                "CSS610-8G-2S",
                "Outro"
            ],
            Outro: ["Outro"]
        };

        // Atualizar modelos quando marca for selecionada
        document.getElementById('marca').addEventListener('change', function () {
            const marca = this.value;
            const modeloSelect = document.getElementById('modelo');
            modeloSelect.innerHTML = "";
            
            if (modelosPorMarca[marca]) {
                modeloSelect.innerHTML = '<option value="">Selecione o modelo...</option>';
                modelosPorMarca[marca].forEach(modelo => {
                    const opt = document.createElement('option');
                    opt.value = modelo;
                    opt.textContent = modelo;
                    modeloSelect.appendChild(opt);
                });
            } else {
                modeloSelect.innerHTML = '<option value="">Selecione a marca primeiro</option>';
            }
        });

        // Envio do formulário
        document.getElementById('formSwitch').onsubmit = async function (e) {
            e.preventDefault();
            const form = e.target;
            const msgDiv = document.getElementById('msg');
            
            // Validar se todos os campos obrigatórios estão preenchidos
            if (!form.nome.value.trim() || !form.marca.value || !form.modelo.value) {
                msgDiv.innerText = 'Por favor, preencha todos os campos obrigatórios!';
                msgDiv.className = 'msg error';
                return;
            }

            const dados = {
                nome: form.nome.value.trim(),
                marca: form.marca.value,
                modelo: form.modelo.value
            };

            try {
                const resp = await fetch('/switches', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dados)
                });
                
                const json = await resp.json();
                
                if (json.status === 'ok') {
                    msgDiv.innerText = 'Switch adicionado com sucesso!';
                    msgDiv.className = 'msg success';
                    form.reset();
                    // Resetar o select de modelo
                    document.getElementById('modelo').innerHTML = '<option value="">Selecione a marca primeiro</option>';
                } else {
                    msgDiv.innerText = 'Erro ao adicionar switch: ' + (json.mensagem || 'Erro desconhecido');
                    msgDiv.className = 'msg error';
                }
            } catch (error) {
                msgDiv.innerText = 'Erro de conexão. Tente novamente.';
                msgDiv.className = 'msg error';
                console.error('Erro:', error);
            }
        };

        window.addEventListener('DOMContentLoaded', function() {
            fetch('/empresa_atual')
                .then(resp => resp.json())
                .then(data => {
                    if (data.logo) {
                        document.getElementById('empresa-logada').innerHTML = `<img src="${data.logo}" alt="Logo da empresa" style="max-height:40px;max-width:120px;object-fit:contain;">`;
                    } else if (data.nome) {
                        document.getElementById('empresa-logada').innerText = 'Empresa: ' + data.nome;
                    }
                });
        });
    </script>
</body>

</html> 